#######################################################################################
powercalc:
  create_utility_meters: true
#######################################################################################

######################################################################################
sensor:
  ####################################################################################
  - platform: template
    sensors:
      ################################################################################
      home_peak_power:
        unique_id: home_peak_power
        value_template: >
          {{
            states('sensor.pool_filter_power') | float(0) +
            states('sensor.roof_water_heater_booster_power') | float(0) +
            states('sensor.kitchen_dish_washer_current_consumption') | float(0) +
            states('sensor.laundry_clothes_dryer_current_consumption') | float(0) +
            states('sensor.laundry_washing_machine_current_consumption') | float(0) +
            states('sensor.bathroom_rails_current_consumption') | float(0)
          }}
      ################################################################################
      home_base_power:
        unique_id: home_base_power
        value_template: >
          {{
            states('sensor.home_lights_power') | float(0) +
            states('sensor.home_fans_power') | float(0) +
            states('sensor.kitchen_coffee_machine_current_consumption') | float(0) +
            states('sensor.kitchen_fridge_current_consumption') | float(0) +
            states('sensor.deck_freezer_current_consumption') | float(0) +
            states('sensor.deck_lights_current_consumption') | float(0) +
            states('sensor.lounge_tv_current_consumption') | float(0) +
            states('sensor.study_outlet_current_consumption') | float(0) +
            states('sensor.office_outlet_current_consumption') | float(0) +
            states('sensor.rack_outlet_current_consumption') | float(0) +
            states('sensor.roof_network_switch_current_consumption') | float(0) +
            states('sensor.study_battery_charger_current_consumption') | float(0) +
            states('sensor.laundry_vacuum_charger_current_consumption') | float(0) +
            states('sensor.various_adhoc_outlet_current_consumption') | float(0)
          }}
      ################################################################################
      home_power:
        unique_id: home_power
        value_template: >
          {{
            states('sensor.home_peak_power') | float(0) +
            states('sensor.home_base_power') | float(0)
          }}
  ####################################################################################
  - platform: template
    sensors:
      ################################################################################
      home_peak_energy_daily:
        unique_id: home_peak_energy_daily
        value_template: >
          {{
            states('sensor.pool_filter_energy_daily') | float(0) +
            states('sensor.roof_water_heater_booster_energy_daily') | float(0) +
            states('sensor.kitchen_dish_washer_today_s_consumption') | float(0) +
            states('sensor.laundry_clothes_dryer_today_s_consumption') | float(0) +
            states('sensor.laundry_washing_machine_today_s_consumption') | float(0) +
            states('sensor.bathroom_rails_today_s_consumption') | float(0)
          }}
      ################################################################################
      home_base_energy_daily:
        unique_id: home_base_energy_daily
        value_template: >
          {{
            states('sensor.home_lights_energy_daily') | float(0) +
            states('sensor.home_fans_energy_daily') | float(0) +
            states('sensor.kitchen_coffee_machine_today_s_consumption') | float(0) +
            states('sensor.kitchen_fridge_today_s_consumption') | float(0) +
            states('sensor.deck_freezer_today_s_consumption') | float(0) +
            states('sensor.deck_lights_today_s_consumption') | float(0) +
            states('sensor.lounge_tv_today_s_consumption') | float(0) +
            states('sensor.study_outlet_today_s_consumption') | float(0) +
            states('sensor.office_outlet_today_s_consumption') | float(0) +
            states('sensor.rack_outlet_today_s_consumption') | float(0) +
            states('sensor.roof_network_switch_today_s_consumption') | float(0) +
            states('sensor.study_battery_charger_today_s_consumption') | float(0) +
            states('sensor.laundry_vacuum_charger_today_s_consumption') | float(0) +
            states('sensor.various_adhoc_outlet_today_s_consumption') | float(0)
          }}
      ################################################################################
      home_energy_daily:
        unique_id: home_energy_daily
        value_template: >
          {{
            states('sensor.home_peak_energy_daily') | float(0) +
            states('sensor.home_base_energy_daily') | float(0)
          }}
      ################################################################################
automation:
  ####################################################################################
  - alias: "Electricity: Smart Plug Polling"
    mode: single
    trigger:
      - platform: time_pattern
        seconds: /5
    condition: [ ]
    action:
      - service: homeassistant.update_entity
        data:
          entity_id:
            - switch.various_adhoc_outlet
  ####################################################################################
