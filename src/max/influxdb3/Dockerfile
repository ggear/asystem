# NOTES: https://docs.influxdata.com/influxdb3/enterprise/release-notes
FROM influxdb:3.5.0-enterprise AS image_upstream
# INFO: Generated by ./docker_deps.sh, itself generated by a fab pull
USER root
RUN \
    apt-get update && \
    DEBIAN_FRONTEND=noninteractive apt-get -y --no-install-recommends --allow-downgrades install bash=5.2.21-2ubuntu4 && \
    DEBIAN_FRONTEND=noninteractive apt-get -y --no-install-recommends --allow-downgrades install less=590-2ubuntu2.1 && \
    DEBIAN_FRONTEND=noninteractive apt-get -y --no-install-recommends --allow-downgrades install curl=8.5.0-2ubuntu10.6 && \
    DEBIAN_FRONTEND=noninteractive apt-get -y --no-install-recommends --allow-downgrades install vim=2:9.1.0016-1ubuntu7.9 && \
    DEBIAN_FRONTEND=noninteractive apt-get -y --no-install-recommends --allow-downgrades install jq=1.7.1-3ubuntu0.24.04.1 && \
    apt-get clean && rm -rf /var/lib/apt/lists/* && \
    mkdir -p /asystem/bin && mkdir -p /asystem/etc && mkdir -p /asystem/mnt

FROM image_upstream AS image_base

FROM image_base AS image_build
# INFO: Generated by ./docker_deps.sh, itself generated by a fab pull
COPY target/package/main/resources/image/. /asystem/etc

FROM image_base AS image_runtime
WORKDIR /asystem/etc
ENTRYPOINT ["/usr/bin/entrypoint.sh"]
CMD ["serve"]
